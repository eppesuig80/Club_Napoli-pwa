<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Club Napoli Partenopei Modena</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1, h2 { text-align: center; }
    .input-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 10px; }
    .input-group input, .input-group select { padding: 5px; min-width: 120px; text-transform: capitalize; }
    .input-group input#provincia { text-transform: uppercase; min-width: 60px; }
    button { padding: 5px 10px; margin: 2px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f3f3f3; }
    #trasfertePreview, #trasferteList { border: 1px dashed #333; padding: 15px; margin-top: 20px; }
    #trasferteList { display: none; }
    .trasferte-controls { text-align: center; margin-top: 10px; }
    @media print {
      body *:not(#trasferteList):not(#trasferteList *) { display: none; }
      #trasferteList { display: block !important; }
    }
  </style>
</head>
<body>
  <img id="logo" src="IMG_9176.PNG" alt="Logo Club Napoli Partenopei Modena" style="max-width:120px; display:block; margin:0 auto 20px;" />
  <h1 contenteditable="true">Club Napoli Partenopei Modena</h1>

  <div class="input-group">
    <input id="nome" placeholder="Nome" oninput="this.value = capitalize(this.value)" />
    <input id="cognome" placeholder="Cognome" oninput="this.value = capitalize(this.value)" />
    <input id="luogo" placeholder="Luogo di nascita" oninput="this.value = capitalize(this.value)" />
    <input id="data" placeholder="Data di nascita (GG/MM/AAAA)" maxlength="10" />
    <input id="residenza" placeholder="Residenza" oninput="this.value = capitalize(this.value); suggestProvincia();" />
    <select id="provincia">
      <option value="">Provincia</option>
      <option value="AG">AG</option>
      <option value="AL">AL</option>
      <option value="AN">AN</option>
      <option value="AO">AO</option>
      <option value="AR">AR</option>
      <option value="AP">AP</option>
      <option value="AT">AT</option>
      <option value="AV">AV</option>
      <option value="BA">BA</option>
      <option value="BT">BT</option>
      <option value="BL">BL</option>
      <option value="BN">BN</option>
      <option value="BG">BG</option>
      <option value="BI">BI</option>
      <option value="BO">BO</option>
      <option value="BZ">BZ</option>
      <option value="BS">BS</option>
      <option value="BR">BR</option>
      <option value="CA">CA</option>
      <option value="CL">CL</option>
      <option value="CB">CB</option>
      <option value="CI">CI</option>
      <option value="CE">CE</option>
      <option value="CT">CT</option>
      <option value="CZ">CZ</option>
      <option value="CH">CH</option>
      <option value="CO">CO</option>
      <option value="CS">CS</option>
      <option value="CR">CR</option>
      <option value="KR">KR</option>
      <option value="CN">CN</option>
      <option value="EN">EN</option>
      <option value="FM">FM</option>
      <option value="FE">FE</option>
      <option value="FI">FI</option>
      <option value="FG">FG</option>
      <option value="FC">FC</option>
      <option value="FR">FR</option>
      <option value="GE">GE</option>
      <option value="GO">GO</option>
      <option value="GR">GR</option>
      <option value="IM">IM</option>
      <option value="IS">IS</option>
      <option value="SP">SP</option>
      <option value="AQ">AQ</option>
      <option value="LT">LT</option>
      <option value="LE">LE</option>
      <option value="LC">LC</option>
      <option value="LI">LI</option>
      <option value="LO">LO</option>
      <option value="LU">LU</option>
      <option value="MC">MC</option>
      <option value="MN">MN</option>
      <option value="MS">MS</option>
      <option value="MT">MT</option>
      <option value="ME">ME</option>
      <option value="MI">MI</option>
      <option value="MO">MO</option>
      <option value="MB">MB</option>
      <option value="NA">NA</option>
      <option value="NO">NO</option>
      <option value="NU">NU</option>
      <option value="OR">OR</option>
      <option value="PD">PD</option>
      <option value="PA">PA</option>
      <option value="PR">PR</option>
      <option value="PV">PV</option>
      <option value="PG">PG</option>
      <option value="PS">PS</option>
      <option value="PE">PE</option>
      <option value="PC">PC</option>
      <option value="PI">PI</option>
      <option value="PT">PT</option>
      <option value="PN">PN</option>
      <option value="PZ">PZ</option>
      <option value="PO">PO</option>
      <option value="RG">RG</option>
      <option value="RA">RA</option>
      <option value="RC">RC</option>
      <option value="RE">RE</option>
      <option value="RI">RI</option>
      <option value="RN">RN</option>
      <option value="RM">RM</option>
      <option value="RO">RO</option>
      <option value="SA">SA</option>
      <option value="SS">SS</option>
      <option value="SV">SV</option>
      <option value="SI">SI</option>
      <option value="SR">SR</option>
      <option value="SO">SO</option>
      <option value="TA">TA</option>
      <option value="TE">TE</option>
      <option value="TR">TR</option>
      <option value="TO">TO</option>
      <option value="TP">TP</option>
      <option value="TN">TN</option>
      <option value="TV">TV</option>
      <option value="TS">TS</option>
      <option value="UD">UD</option>
      <option value="VA">VA</option>
      <option value="VE">VE</option>
      <option value="VB">VB</option>
      <option value="VC">VC</option>
      <option value="VR">VR</option>
      <option value="VV">VV</option>
      <option value="VI">VI</option>
      <option value="VT">VT</option>
    </select>
    <input id="tessera" placeholder="Numero Tessera" />
  </div>

  <div>
    <button onclick="addUser()">‚ûï Aggiungi</button>
    <button onclick="saveArchivio()">üíæ Salva Archivio</button>
    <button onclick="loadArchivio()">üìÇ Carica Archivio</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Cognome e Nome</th>
        <th>Luogo e Data</th>
        <th>Residenza</th>
        <th>Provincia</th>
        <th>Tessera</th>
        <th>Azioni</th>
      </tr>
    </thead>
    <tbody id="userTable"></tbody>
  </table>

  <div id="trasfertePreview">
    <h2 contenteditable="true">Trasferta</h2>
    <ol id="trasferteData"></ol>
    <div class="trasferte-controls">
      <button onclick="saveTrasferte()">üíæ</button>
      <button onclick="window.print()">üñ®Ô∏è</button>
    </div>
  </div>

  <div id="trasferteList">
    <h2><b>Trasferte</b></h2>
    <ol id="trasferteDataPrint"></ol>
  </div>

  <script>
    let users = [], trasferte = [];

    function capitalize(text) {
      return text.replace(/\b\w/g, l => l.toUpperCase());
    }

    document.getElementById("data").addEventListener("input", function(e) {
      let val = e.target.value.replace(/\D/g, "");
      if (val.length >= 2 && val.length < 4) val = val.slice(0, 2) + '/' + val.slice(2);
      if (val.length >= 4) val = val.slice(0, 2) + '/' + val.slice(2, 4) + '/' + val.slice(4, 8);
      e.target.value = val;
    });

    function suggestProvincia() {
      const map = {
        napoli: "NA", firenze: "FI", milano: "MI", roma: "RM", torino: "TO", modena: "MO", bologna: "BO"
      };
      const res = document.getElementById("residenza").value.toLowerCase();
      if (map[res]) document.getElementById("provincia").value = map[res];
    }

    function addUser() {
      const nome = capitalize(document.getElementById("nome").value.trim());
      const cognome = capitalize(document.getElementById("cognome").value.trim());
      const luogo = capitalize(document.getElementById("luogo").value.trim());
      const data = document.getElementById("data").value;
      const residenza = capitalize(document.getElementById("residenza").value.trim());
      const provincia = document.getElementById("provincia").value;
      const tessera = document.getElementById("tessera").value.trim();

      if (!nome || !cognome || !luogo || !data || !residenza || !provincia || !tessera) {
        alert("Compila tutti i campi!"); return;
      }

      users.push({ nome, cognome, luogo, data, residenza, provincia, tessera });
      renderUsers();
      document.querySelectorAll('.input-group input, .input-group select').forEach(el => el.value = '');
    }

    function renderUsers() {
      const tbody = document.getElementById("userTable");
      tbody.innerHTML = "";
      users.forEach((u, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${u.cognome} ${u.nome}</td>
          <td>${u.luogo}, ${u.data}</td>
          <td>${u.residenza}</td>
          <td>${u.provincia}</td>
          <td>${u.tessera}</td>
          <td>
            <button onclick="addToTrasferte(${i})">‚¨ÜÔ∏è</button>
            <button onclick="editUser(${i})">‚öôÔ∏è</button>
            <button onclick="deleteUser(${i})">üóëÔ∏è</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function editUser(i) {
      const u = users[i];
      u.nome = capitalize(prompt("Nome", u.nome) || u.nome);
      u.cognome = capitalize(prompt("Cognome", u.cognome) || u.cognome);
      u.luogo = capitalize(prompt("Luogo", u.luogo) || u.luogo);
      u.data = prompt("Data", u.data) || u.data;
      u.residenza = capitalize(prompt("Residenza", u.residenza) || u.residenza);
      u.provincia = prompt("Provincia", u.provincia) || u.provincia;
      u.tessera = prompt("Tessera", u.tessera) || u.tessera;
      renderUsers();
    }

    function deleteUser(i) {
      users.splice(i, 1);
      renderUsers();
    }

    function addToTrasferte(i) {
      const u = users[i];
      const line = `${u.cognome} ${u.nome} - ${u.luogo} ${u.data} - ${u.residenza} (${u.provincia}) - ${u.tessera}`;
      trasferte.push(line);
      renderTrasferte();
    }

    function renderTrasferte() {
      const prev = document.getElementById("trasferteData");
      const print = document.getElementById("trasferteDataPrint");
      prev.innerHTML = "";
      print.innerHTML = "";
      trasferte.forEach((t, i) => {
        const li = document.createElement("li");
        li.innerHTML = `${t}
          <button onclick="moveUp(${i})">‚¨ÜÔ∏è</button>
          <button onclick="moveDown(${i})">‚¨áÔ∏è</button>
          <button onclick="editTrasferta(${i})">‚öôÔ∏è</button>
          <button onclick="deleteTrasferta(${i})">üóëÔ∏è</button>`;
        prev.appendChild(li);
        const li2 = document.createElement("li");
        li2.textContent = t;
        print.appendChild(li2);
      });
    }

    function moveUp(i) {
      if (i > 0) [trasferte[i - 1], trasferte[i]] = [trasferte[i], trasferte[i - 1]];
      renderTrasferte();
    }

    function moveDown(i) {
      if (i < trasferte.length - 1) [trasferte[i], trasferte[i + 1]] = [trasferte[i + 1], trasferte[i]];
      renderTrasferte();
    }

    function editTrasferta(i) {
      const val = prompt("Modifica trasferita", trasferte[i]);
      if (val) {
        trasferte[i] = val;
        renderTrasferte();
      }
    }

    function deleteTrasferta(i) {
      trasferte.splice(i, 1);
      renderTrasferte();
    }

    function saveTrasferte() {
      const blob = new Blob([trasferte.map((d, i) => `${i + 1}. ${d}`).join("\n")], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "trasferte.txt";
      a.click();
    }

    function saveArchivio() {
      const blob = new Blob([JSON.stringify({ utenti: users, trasferte }, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "archivio.json";
      a.click();
    }

    function loadArchivio() {
      const i = document.createElement('input');
      i.type = 'file';
      i.accept = '.json';
      i.onchange = e => {
        const f = e.target.files[0];
        if (!f) return;
        const r = new FileReader();
        r.onload = ev => {
          const d = JSON.parse(ev.target.result);
          users = d.utenti || [];
          trasferte = d.trasferte || [];
          renderUsers();
          renderTrasferte();
        };
        r.readAsText(f);
      };
      i.click();
    }
  </script>
</body>
</html>
